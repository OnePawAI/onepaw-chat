<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OnePaw AI Chat (Always Ask Name)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    #welcomeScreen, #chat { max-width: 600px; margin: auto; }
    #chat { display: none; }
    #messages { border: 1px solid #ccc; height: 400px; overflow-y: scroll; padding: 10px; background: #fff; margin-bottom: 10px; }
    #inputArea { display: flex; }
    #userInput { flex: 1; padding: 10px; }
    #sendBtn { padding: 10px; }
    .message { margin: 5px 0; }
    .user { text-align: right; color: blue; }
    .bot { text-align: left; color: green; }
  </style>
</head>
<body>

<div id="welcomeScreen">
  <h2>Welcome to OnePaw AI Assistant! ðŸ‘‹</h2>
  <p>Please enter your preferred name to start chatting:</p>
  <input id="nameInput" type="text" placeholder="Your Name" />
  <br><br>
  <button id="startChatBtn">Start Chat</button>
</div>

<div id="chat">
  <h2>Chat with OnePaw AI Assistant</h2>
  <div id="messages"></div>
  <div id="inputArea">
    <input id="userInput" type="text" placeholder="Type your message here..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script>
const webhookUrl = "https://651e-2600-1700-e860-8120-787a-1891-ed1-9253.ngrok-free.app/webhook/17231c01-649d-4b74-ad0b-fd9239c478da";  // replace with your webhook

let preferredName = null;

// Always show welcome screen on load
document.getElementById('welcomeScreen').style.display = 'block';
document.getElementById('chat').style.display = 'none';

document.getElementById('startChatBtn').addEventListener('click', () => {
  const nameInput = document.getElementById('nameInput').value.trim();
  if (!nameInput) return alert("Please enter your name to continue.");
  preferredName = nameInput;
  document.getElementById('welcomeScreen').style.display = 'none';
  document.getElementById('chat').style.display = 'block';
  addMessage('bot', `Hi ${preferredName}! How can I assist you today?`);
});

document.getElementById('sendBtn').addEventListener('click', async () => {
  const inputField = document.getElementById('userInput');
  const message = inputField.value.trim();
  if (!message) return;

  addMessage('user', message);
  inputField.value = '';

  const res = await fetch(webhookUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ preferredName, message })
  });
  const data = await res.json();
  addMessage('bot', data.reply || "Sorry, I didn't understand that.");
});

function addMessage(sender, text) {
  const msgDiv = document.createElement('div');
  msgDiv.className = `message ${sender}`;
  msgDiv.textContent = text;
  document.getElementById('messages').appendChild(msgDiv);
  document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
}
</script>

</body>
</html>
